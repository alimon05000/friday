<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F.R.I.D.A.Y. OS</title>
    <meta name="theme-color" content="#050505">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkZSSURBWSBBSSIsCiAgInNob3J0X25hbWUiOiAiRlJJREFZIiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIi01MDUwNSIsCiAgInRoZW1lX2NvbG9yIjogIi0wMGYzZmYiCn0=">
    
    <style>
        :root {
            --neon: #00f3ff;
            --dark-neon: #001a1d;
            --bg: #050505;
        }

        body {
            background: var(--bg);
            color: var(--neon);
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* Анимированный фон (Hud-эффект) */
        #scanner {
            position: absolute;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--neon), transparent);
            top: 0;
            opacity: 0.2;
            animation: scan 4s linear infinite;
        }

        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }

        /* Ядро */
        .ai-core {
            width: 250px;
            height: 250px;
            position: relative;
            cursor: pointer;
        }

        .layer {
            position: absolute;
            border-radius: 50%;
            border: 2px solid var(--neon);
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .outer { width: 100%; height: 100%; border-style: double; border-width: 6px; animation: rotate 15s linear infinite; opacity: 0.3; }
        .middle { width: 70%; height: 70%; border-style: dashed; animation: rotate-rev 10s linear infinite; opacity: 0.6; }
        .inner { 
            width: 40%; height: 40%; 
            background: radial-gradient(circle, #fff, var(--neon));
            box-shadow: 0 0 40px var(--neon);
        }

        /* Состояния */
        .active .inner { box-shadow: 0 0 80px var(--neon); transform: translate(-50%, -50%) scale(1.2); }
        .listening .middle { border-color: #fff; opacity: 1; }

        .interface {
            margin-top: 50px;
            text-align: center;
            z-index: 5;
            max-width: 90%;
        }

        #status {
            font-size: 0.7rem;
            letter-spacing: 5px;
            margin-bottom: 20px;
            color: var(--neon);
            opacity: 0.5;
        }

        #output {
            font-size: 1.4rem;
            min-height: 2em;
            text-shadow: 0 0 10px var(--neon);
            font-weight: 300;
        }

        .session-timer {
            font-size: 0.6rem;
            margin-top: 10px;
            color: #ff003c;
        }

        button {
            background: transparent;
            border: 1px solid var(--neon);
            color: var(--neon);
            padding: 15px 40px;
            letter-spacing: 3px;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover { background: var(--neon); color: #000; }

        @keyframes rotate { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }
        @keyframes rotate-rev { from { transform: translate(-50%, -50%) rotate(360deg); } to { transform: translate(-50%, -50%) rotate(0deg); } }
    </style>
</head>
<body>

    <div id="scanner"></div>

    <div class="ai-core" id="core-trigger">
        <div class="layer outer"></div>
        <div class="layer middle"></div>
        <div class="layer inner"></div>
    </div>

    <div class="interface">
        <div id="status">SYSTEM OFFLINE</div>
        <div id="output">НАЖМИТЕ ДЛЯ ИНИЦИАЛИЗАЦИИ</div>
        <div id="session-info" class="session-timer"></div>
    </div>

    <script>
        const core = document.querySelector('.ai-core');
        const output = document.getElementById('output');
        const status = document.getElementById('status');
        const sessionInfo = document.getElementById('session-info');

        let recognition;
        let synth = window.speechSynthesis;
        let isSessionActive = false;
        let sessionTimeout;

        // Настройка распознавания
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = false;
            recognition.lang = 'ru-RU';

            recognition.onresult = (event) => {
                const result = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
                handleInput(result);
            };

            recognition.onend = () => { if(!synth.speaking) recognition.start(); };
        }

        function handleInput(text) {
            console.log("Слышу:", text);
            
            // Если сессия не активна, ищем "Привет Пятница"
            if (!isSessionActive) {
                if (text.includes("привет пятница") || text.includes("пятница")) {
                    activateSession();
                    respond("Слушаю вас. Все системы активированы.");
                }
                return;
            }

            // Если сессия активна, обрабатываем команды без префикса
            resetSessionTimer();
            processCommand(text);
        }

        function activateSession() {
            isSessionActive = true;
            core.classList.add('active');
            status.textContent = "SESSION ACTIVE";
            resetSessionTimer();
        }

        function resetSessionTimer() {
            clearTimeout(sessionTimeout);
            sessionInfo.textContent = "АКТИВНЫЙ РЕЖИМ: 10 СЕК";
            sessionTimeout = setTimeout(() => {
                isSessionActive = false;
                core.classList.remove('active');
                status.textContent = "WAITING FOR WAKE WORD";
                sessionInfo.textContent = "";
            }, 10000); // 10 секунд на общение без упоминания имени
        }

        function processCommand(cmd) {
            if (cmd.includes("кто ты")) {
                respond("Я Пятница. Ваш персональный ассистент.");
            } else if (cmd.includes("статус") || cmd.includes("систем")) {
                respond("Все протоколы функционируют нормально. Критических ошибок не обнаружено.");
            } else if (cmd.includes("спасибо") || cmd.includes("отбой")) {
                isSessionActive = false;
                respond("Всегда пожалуйста. Перехожу в режим ожидания.");
            } else if (cmd.includes("время")) {
                respond("Сейчас " + new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'}));
            } else {
                respond("Запрос принят. Обрабатываю информацию.");
            }
        }

        function respond(text) {
            recognition.stop();
            output.textContent = text;
            
            const utterance = new SpeechSynthesisUtterance(text);
            
            // Настройка "живого" голоса
            const voices = synth.getVoices();
            // Ищем лучшие голоса (Google, Microsoft или Apple)
            const premiumVoice = voices.find(v => v.lang.includes('ru') && (v.name.includes('Google') || v.name.includes('Microsoft'))) 
                               || voices.find(v => v.lang.includes('ru'));

            utterance.voice = premiumVoice;
            utterance.pitch = 1.05; // Чуть выше для женского тембра
            utterance.rate = 1.0;   // Скорость речи

            utterance.onstart = () => core.classList.add('listening');
            utterance.onend = () => {
                core.classList.remove('listening');
                recognition.start();
            };

            synth.speak(utterance);
        }

        core.onclick = () => {
            if (status.textContent === "SYSTEM OFFLINE") {
                recognition.start();
                status.textContent = "WAITING FOR WAKE WORD";
                output.textContent = "Скажите: 'Привет, Пятница'";
                
                // Фиктивный запуск звука (разблокировка аудио в браузере)
                const silent = new SpeechSynthesisUtterance("");
                synth.speak(silent);
            }
        };

        // Service Worker для PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => {});
        }
    </script>
</body>
</html>
